# Домашнее задание: автотесты

Вам дано приложение на JavaScript и нужно написать для него автотесты: интеграционные тесты на интерфейс и модульные тесты на серверную часть.

## Предметная область

Приложение отображает в браузере информацию из git репозитория: список коммитов, файловую систему для выбранного коммита, содержимое выбранного файла (поддерживаются только текстовые форматы). Для удобства навигации на каджой странице отображаются "хлебные крошки".

## Как запустить

```sh
git clone git@github.com:dima117/shri-testing-homework.git
cd shri-testing-homework.git
npm i
npm start
```

## Интеграционные тесты

Сценарии для интеграционных тестов

- на всех страницах (история коммитов, просмотр файловой системы, просмотр содержимого файла) правильно отображается их содержимое;
- правильно работают переходы по страницам
  - из списка коммитов на список файлов
  - из списка файлов во вложенную папку
  - из списка файлов на страницу отдельного файла
  - переходы по хлебным крошкам

## Модульные тесты

- нужно добавить в README список логических блоков системы и их сценариев
- для каждого блока нужно написать модульные тесты
- если необходимо, выполните рефакторинг, чтобы реорганизовать логические блоки или добавить точки расширения

# Решение

## Интеграционные тесты

Список тестов находится в файле `hermione/simple.hermione.js`.

Запуск тестов:

```console
selenium-standalone start
./node_modules/.bin/hermione  hermione/simple.hermione.js
npx hermione gui
```

## Модульные тесты

### Логические блоки

1. История коммитов (/controllers/indexController.js)

Функция `gitHistory(1, 20)` отдает нам массив объектов {hash, author, timestamp, msg} для последних коммитов (1 страница, максимум 20 коммитов). Он может меняться, поэтому предсказать результат этой функции мы не можем. Мы проходим по массиву и `buildFolderUrl(item.hash, '')` добавляет в каждый объект коммита еще один параметр href - ссылку для его файловой системы (здесь для этой функции всегда 1 тип ссылки и один сценарий - /files/* ). Для главной страницы `buildBreadcrumbs()` отдает нам массив из одного объекта {text, href} с текстом HISTORY и без ссылки. Полученные массивы (коммиты и навигация) мы отрисовываем через шаблон `/views/index.hbs` на страницу с заголовком "history".

2. Файловая система (/controllers/filesController.js)

Из текущего url `/files/{hash}/{path}` мы получаем hash и path (текущая директория) коммита. Функция `gitFileTree(hash, path)` отдает массив объектов {type, hash, path} для содержимого текущей директории. Можно предположить, что для отдельно взятого старого коммита данные меняться не должны(?). Мы проходим по массиву и `buildObjectUrl(hash, item)` добавляет в каждый объект еще один параметр href - ссылку для файла или директории (здесь для этой функции 2 типа ссылок и два сценария - /files/* для директорий или /content/* для содержимого файлов). Полученные массивы (файловая система и навигация) мы отрисовываем через шаблон `/views/files.hbs` на страницу с заголовком "files".

3. Содержимое файла (/controllers/contentController.js)

Функция `gitFileTree(hash, path.join('/'))` возвращает объект с параметрами файла {type, hash, path}. Функция `gitFileContent(file.hash)` возвращает соодержимое файла. Функция `buildBreadcrumbs(hash, path.join('/'))` возвращает навигацию. Полученные данные (содержимое файла и навигация) мы отрисовываем через шаблон `/views/content.hbs` на страницу с заголовком "files".

4. Навигация (/utils/navigation.js)

Содержит функции buildFolderUrl(), buildFileUrl() и buildBreadcrumbs(), которые используются первыми тремя блоками.

5. Git (/utils/git.js) ?

Содержит функции gitHistory, gitFileTree, gitFileContent, которые используются первыми тремя блоками, и функции executeGit, parseHistoryItem, parseFileTreeItem, которые используются другими функциями модуля.

### Запуск тестов:

```console
npm test
```

### Рефакторинг

Я перенесла функцию buildObjectUrl() в module.exports модуля navigation.js, чтобы ее можно было тестировать.
