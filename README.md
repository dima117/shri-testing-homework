# Домашнее задание: автотесты

Вам дано приложение на JavaScript и нужно написать для него автотесты: интеграционные тесты на интерфейс и модульные тесты на серверную часть.

## Предметная область

Приложение отображает в браузере информацию из git репозитория: список коммитов, файловую систему для выбранного коммита, содержимое выбранного файла (поддерживаются только текстовые форматы). Для удобства навигации на каджой странице отображаются "хлебные крошки".

## Интеграционные тесты

Сценарии для интеграционных тестов

- на всех страницах (история коммитов, просмотр файловой системы, просмотр содержимого файла) правильно отображается их содержимое;
- правильно работают переходы по страницам
  - из списка коммитов на список файлов
  - из списка файлов во вложенную папку
  - из списка файлов на страницу отдельного файла
  - переходы по хлебным крошкам

## Модульные тесты

- нужно добавить в README список логических блоков системы и их сценариев
- для каждого блока нужно написать модульные тесты
- если необходимо, выполните рефакторинг, чтобы реорганизовать логические блоки или добавить точки расширения

### Логика модульных тестов

- Работа с Git
  - общение с гитовой консолью, передача ей команд с параметрами
  - парсинг полученных команд из строк в массивы объектов / строки другого формата
  - асинхронность, начиная от консольного ответа и до рендеринга инфы

- Навигация
  - построение ссылок на файлы и папки
  - построение хлебных крошек

- Контроллер файлов
  - решает, какого типа коммит пришёл от консоли (блоб, дерево)
  - дополнительный сплиттинг и парсинг путей/данных
  - отправка данных на шаблонизацию и рендеринг

- Контроллер главной страницы
  - определение размера данных для рендеринга
  - отправка данных на шаблонизацию и рендеринг

## Сделано помимо тестов
- Убрана лишняя зависимость, подчищен код (без фанатизма)
- для интеграционных тестов повесил дополнительные БЭМ-классы, думаю, хуже не стало (они бы там всё равно висели при продакшене)
- работу с гитом убрал в отдельный класс, чтобы стабался и мокался легче через properties shadowing
- в indexController и filesController вспомогательные функции вытащил за модуль. Не самое элегантное решение, можно было бы тоже что-нибудь с классами придумать, но очень мало времени оставалось
- в indexController написал маленькую функцию для подхачивания размера гит-истории, чтобы Гермиона нормально валидировала страницу. Хак убирается простым переключением `offsetHacked = false`

## Как запустить

`npm i -> npm start или npm devserver -> npm run hermi или npm run test`

## Как обновить снэпшоты

`npm run hermi gui -> выбрать новые`

## Немного кулстори
Нужно излить душу! Начал делать задание на модном Jest-е вообще без задней мысли, вроде бодренько, как подошёл к Гермионе внезапно оказалось, что она
общается только с Мокой/Чаем. Сами тесты мои мне тоже не понравились, психанул и откатил репо до ремоута, написал всё заново. Сама Гермиона тоже совершенно неприличное количество времени отняла на поднятие.

Тестов я раньше не писал, но что-то в этом есть, даже несмотря на мои попутные мучения. В итоге Мока и Чай с Синоном мне и понравились больше Джеста, главным образом из-за такого, более повествовательного образа изложения тестов, хорошо ложится и в голову и в код. В Jest стиль assertion не настолько модульный, поэтому "литературность" тестового утверждения хромает. в Jest зато весь функционал stub, mock и spy объединены в один Jest.fn, довольно удобно.
