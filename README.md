# Домашнее задание: автотесты

Вам дано приложение на JavaScript и нужно написать для него автотесты: интеграционные тесты на интерфейс и модульные тесты на серверную часть.

## Предметная область

Приложение отображает в браузере информацию из git репозитория: список коммитов, файловую систему для выбранного коммита, содержимое выбранного файла (поддерживаются только текстовые форматы). Для удобства навигации на каджой странице отображаются "хлебные крошки".

## Как запустить

```sh
git clone git@github.com:dima117/shri-testing-homework.git
cd shri-testing-homework.git
npm i
npm start
```

## Интеграционные тесты

Сценарии для интеграционных тестов

- на всех страницах (история коммитов, просмотр файловой системы, просмотр содержимого файла) правильно отображается их содержимое;
- правильно работают переходы по страницам
  - из списка коммитов на список файлов
  - из списка файлов во вложенную папку
  - из списка файлов на страницу отдельного файла
  - переходы по хлебным крошкам

## Модульные тесты

- нужно добавить в README список логических блоков системы и их сценариев
- для каждого блока нужно написать модульные тесты
- если необходимо, выполните рефакторинг, чтобы реорганизовать логические блоки или добавить точки расширения

## Выполнение домашнего задания

### Запуск
1. Клонируем репозиторий

```
git clone https://github.com/MoonW1nd/shri-testing-homework.git
```

2. Переключаемся на ветку с домашней работой
```
git checkout testing-homework-ivankov
```

3. Установка подмодулей
```
git submodule init
git submodule update
```

4. Установка зависимостей

Устанавливаем selenium(если нужно):
```
npm install selenium-standalone@latest -g
selenium-standalone install
```

Устанавливаем зависимости:
```
npm install
```

> в процессе установки зависимостей могут возникнуть пробелмы с Xcode, решение можно найти [тут](https://github.com/nodejs/node-gyp#on-windows) или [тут](https://github.com/nodejs/node-gyp/issues/569)

### Интеграционные тесты

#### Запуск интеграционных тестов

Запускаем selenium

```
selenium-standalone start
```

Запускаем тестовый сервер

```
npm run-script start-testing
```

Запускаем hermione тесты

```
npm run-script hermione
```
> запуск gui `npm run-script hermione-gui`


Для удобной реализации тестов написал собственный плагин `hermione-custom-commands`;

Специально для интеграционного тестирования был создан специальный stub репозиторий, в котором находится не меняющаяся история коммитов, что позволяет тестировать скриншотами.

Сценарии для интеграционных тестов

- [x] на всех страницах (история коммитов, просмотр файловой системы, просмотр содержимого файла) правильно отображается их содержимое;
  > Правильность отображения содержимого проверялась тестами с помощью скриншотов. </br> **! Следует обратить внимание что на мониторах с разным DPR(Device Pixel Ratio) скриншоты получаются разного размера что приводит к падению тестов**
- правильно работают переходы по страницам
  - [x] из списка коммитов на список файлов
  - [x] из списка файлов во вложенную папку
  - [x] из списка файлов на страницу отдельного файла
  - [x] переходы по хлебным крошкам

### Модульные тесты

#### Запуск интеграционных тестов
  Запускаем модульные тесты

  ```
  npm run-script unit
  ```
  > для  одновременного запуска интеграционных тестов и модульных нужно выполнить команду `npm test`

  Логические блоки:
  
  - получение контента коммита
  - получение файлового дерева
  - получение истории коммитов
  - получение ссылки на контент файла
  - получение ссылки на определенную папку
  - построение хлебных крошек
  - передача данных в шаблонизатор в зависимости от url

  Точки расширения выполнены в виде приватных свойств функций. Если их задать то переопределяется определенная зависимость. Выбран именно такой способ, так как он не меняет сигнатуру функции, а соответственно не ломает API, как например способ с переписыванием на класс или добавление дополнительного параметра.

  Так же в открытый API была вынесена функция executeGit, для удобства переопределения в тестах.

  Дополнительно:
  - добавил eslint и прекоммит хуки

### Используемые библиотеки

- [mocha](https://www.npmjs.com/package/mocha) - тестовый фреймворк
- [chai](https://www.npmjs.com/package/chai) - assertion библиотека
- [supertest](https://www.npmjs.com/package/supertest) - тестирование express запросов
- [sinon](https://www.npmjs.com/package/sinon) - создание mock
